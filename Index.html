<!DOCTYPE html>
<html>
<head>
    <title>Test Setup</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 50px auto; padding: 20px; }
        .field { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, button { width: 100%; padding: 8px; margin: 5px 0; }
        button { background: #007cba; color: white; border: none; padding: 10px; cursor: pointer; }
        button:hover { background: #005a87; }
        .reset { background: #ccc; color: black; margin-top: 10px; }
        .reset:hover { background: #aaa; }
    </style>
</head>
<body>
<div id="setup">
    <div class="field">
        <label>Workstation ID:</label>
        <div id="workstationId">Incorrect login</div>
    </div>

    <div class="field">
        <label for="participantId">Participant ID:</label>
        <input type="text" id="participantId" placeholder="Enter participant ID">
    </div>

    <div class="field">
        <label for="testType">Test Type:</label>
        <select id="testType">
            <option value="training">Training</option>
            <option value="trial1">Trial 1</option>
            <option value="trial2">Trial 2</option>
        </select>
    </div>

    <button onclick="startTest()">Start Test</button>
    <button class="reset" onclick="resetCredentials()">Change Workstation ID</button>
</div>

<script>
    let workstationId;
    window.onload = async function() {
        workstationId = "Error"
        try {
            let response = await fetch('/Login');
            let username = response.headers.get('X-username');
            workstationId = username || 'Unknown';
        } catch (e) {
            console.log(e)
        }
        document.getElementById('workstationId').textContent = workstationId;
    }


    function startTest() {
        const participantId = document.getElementById('participantId').value;
        const testType = document.getElementById('testType').value;

        if (!participantId) {
            alert('Please enter Participant ID');
            return;
        }

        const params = {
            workstationId,
            participantId,
            testType
        };

        window.location.href = `Runner.html#${encodeURIComponent(JSON.stringify(params))}`
    }

    function resetCredentials() {
        // Clear any existing credentials and reload with basic auth reset
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = `http://logout:logout@${window.location.host}/`;
        document.body.appendChild(iframe);

        setTimeout(() => {
            document.body.removeChild(iframe);
            window.location.reload();
        }, 100);
    }
</script>
</body>
</html>